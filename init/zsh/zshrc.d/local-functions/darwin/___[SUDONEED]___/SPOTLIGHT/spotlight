#! /usr/bin/env zsh -f

##########################################################################################
#                                                                                        #
#  ZaemonSH created by :                                                                 #
#  Zucchelli Bryan && @N@TOME && Admiral Gr@ss H0pper on Oct 13, 2016.                   #
#  Copyright (c) 2019. All rights reserved.                                              #
#  Inspired by zsh-templates-osx created by :                                            #
#  William Scott on May 11, 2007.                                                        #
#  Copyright (c) 2007. All rights reserved.                                              #
#                                                                                        #
#  This program is free software; you can redistribute it and/or modify it under         #
#  the terms of the GNU General Public License as published by the Free Software         #
#  Foundation; either version 2 of the License, or (at your option) any later version.   #
#                                                                                        #
#  This program is distributed in the hope that it will be useful, but WITHOUT           #
#  ANY WARRANTY ; without even the implied warranty of MERCHANTABILITY or                #
#  FITNESS FOR A PARTICULAR PURPOSE.                                                     #
#  See the GNU General Public License for more details.                                  #
#                                                                                        #
#  You should have received a copy of the GNU General Public License                     #
#  along with this program ; if not, write to the Free Software Foundation,              #
#  Inc., 51 Franklin Street, Fifth Floor, Boston,  MA 02110-1301 USA                     #
#                                                                                        #
#  cf. URL:   http://www.fsf.org/licensing/licenses/gpl.html                             #
#                                                                                        #
##########################################################################################

#----------------------------------------------------------------------------------------#
#                                     DESCRIPTION
#----------------------------------------------------------------------------------------#
# spotlight :
# Control spotlight config with CLI.

#----------------------------------------------------------------------------------------#
#                                        TODO
#----------------------------------------------------------------------------------------#

#----------------------------------------------------------------------------------------#
#                                       CHANGES
#----------------------------------------------------------------------------------------#
# 08/01/2018 :
#  • Create this function by merging all past alias (from 022_aliases.darwin-specific.additional.zsh) 
#    related to spotlight (alias SpotlightIndexingStatus, SpotlightOn SpotlightOff SpotlightLockIndex
#    SpotlightUnlockIndex SpotlightPublishIndex SpotlightRemoveIndex SpotlightRemoveStore"

# 04/08/2019 :
# • Add hide-spotlight icon
#----------------------------------------------------------------------------------------#
#                                       CONFIG
#----------------------------------------------------------------------------------------#
#######################
## COMMAND VARIABLES ##
#######################
local VERSION FCT_NAME

VERSION="0.0.3"
FCT_NAME="$(echo $0)"

#----------------------------------------------------------------------------------------#
#                                      FUNCTIONS
#----------------------------------------------------------------------------------------#
banner () {
     clear
     echo " ##############################################################################"
     echo " #                                                                            #"
     echo " #  ${GREEN}This is ${RED}$FCT_NAME: ${YEL}$VERSION on ${GREEN}$OSTYPE${NC}${YEL} system.${NC}"
     echo " #  CopyL®®v 2020, Zucchelli Bryan                                            #"
     echo " #                                                                            #"
     echo " #  Unless required by applicable law or agreed to in writing, software       #"
     echo " #  distributed under the License is distributed on an AS IS BASIS,           #"
     echo " #  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.  #"
     echo " #  See the License for the specific language governing permissions and       #"
     echo " #  limitations under the License.                                            #"
     echo " #                                                                            #"
     echo " ##############################################################################"
     echo ""
}

help(){
    cat<<__EOF__
    ${RED} 
    usage: spotlight [ IndexingStatus | On | Off | LockIndex | PublishIndex | RemoveIndex | RemoveStore | help ]
    
    Examples:
            'spotlight IndexingStatus.            # Show Spotlight index status'
            'Spotlight On                         # Turn Spotlight indexing on.'
            'spotlight Off                        # Turn Spotlight indexing off.'
            'spotlight LockIndex                  # Set volume to never be indexed'
            'spotlight PublishIndex               # Publish indexes to drive.'
            'spotlight RemoveIndex                # Remove Spotlight indexes.'
            'spotlight RemoveStore                # Remove Spotlight store.'
    ${NC}
__EOF__
}

SpotlightIndexingStatus(){
  # Show Spotlight index status.
  command sudo -S mdutil -s /
}

SpotlightOn(){
  # Turn Spotlight indexing on.
  command sudo -S command mdutil -i on /
}

SpotlightOff(){
  # Turn Spotlight indexing off.
  command sudo -S command mdutil -i off /
}

SpotlightLockIndex(){
  # Set volume to never be indexed (root used as example).
  command sudo -S command touch /.metadata_never_index
}

SpotlightUnlockIndex(){
  # Set volume to be indexed (root used as example).
  command sudo -S command rm /.metadata_never_index
}

SpotlightPublishIndex(){
  # Publish indexes to drive.
  command sudo -S command mdutil -p /
}

SpotlightRemoveIndex(){
  # Remove Spotlight indexes.
  command sudo -S command mdutil -E /
} 

SpotlightRemoveStore(){
  # Remove Spotlight store.
  command sudo -S command rm -fr /.Spotlight-V100
} 
  
hide-spotlight_icon() {
  command sudo mv /System/Library/CoreServices/Search.bundle /System/Library/CoreServices/Search.bundle.bak
}
#-------------------------------------------------------------------------------------------#
#                                              SCRIPT
#-------------------------------------------------------------------------------------------#
banner
case $1 in
    help)
        help
        ;;
    IndexingStatus)
        SpotlightIndexingStatus
        ;;
    On)
        shift
        SpotlightOn
        ;;
    Off)
        shift
        SpotlightOff
        ;;
    LockIndex)
        shift
        SpotlightLockIndex
        ;; 
    UnlockIndex)
        shift
        SpotlightUnlockIndex
        ;;
    PublishIndex)
        shift
         SpotlightPublishIndex
        ;;
    RemoveIndex)
        shift
        SpotlightRemoveIndex
        ;;        
    RemoveStore)
        shift
        SpotlightRemoveStore
        ;;
    *)
        help
        ;;
esac
